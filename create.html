<!doctype html>

<html>
	<head>
		<title>LevelBuilder</title>
		<meta charset="utf-8" />

		<style type="text/css">

			#canvas{background-color: #686868;}

		</style>

		<script type="text/javascript">

			var vx = [];
			var eg = []
			var linestart = null;
			var lineend = null; 
			var startindex; 
			var endindex; 
			var obj = {
				vertices: vx,
				edges: eg

			};

			document.addEventListener("DOMContentLoaded", init, false);

			function init()
			{
				var canvas = document.getElementById("canvas");

				drawGrid();

				canvas.addEventListener("mousedown", getPosition, false);
			}

			function drawGrid(){
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");
				
				ctx.beginPath();
				ctx.moveTo(120, 0)
				ctx.lineTo(120, 800)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(240, 0)
				ctx.lineTo(240, 800)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(360, 0)
				ctx.lineTo(360, 800)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(160, 0)
				ctx.lineTo(160, 800)
				ctx.stroke();
				
				ctx.beginPath();
				ctx.moveTo(320, 0)
				ctx.lineTo(320, 800)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(0, 200)
				ctx.lineTo(480, 200)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(0, 400)
				ctx.lineTo(480, 400)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(0, 600)
				ctx.lineTo(480, 600)
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(0, (800/3))
				ctx.lineTo(480, (800/3))
				ctx.stroke();

				ctx.beginPath();
				ctx.moveTo(0, (1600/3))
				ctx.lineTo(480, (1600/3))
				ctx.stroke();
				//end of creation of grid
				
			}

			function getPosition(event)
			{
				var x = new Number();
				var y = new Number();
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");

				if (event.x != undefined && event.y != undefined)
				{
					x = event.x;
					y = event.y;
					var oldX = x - canvas.offsetLeft;
					var oldY = y - canvas.offsetTop;
					var incircle = false; 
					x = oldX/480;
					y = oldY/800;

					
					for(i = 0; i < vx.length; i++)
					{
						// console.log(distance(x*480, vx[i].x * 480, y * 800, vx[i].y * 800)); 

						if (distance(x*480, vx[i].x * 480, y * 800, vx[i].y * 800) < 10)
						{
							incircle = true; 
							if(linestart == null){
								// console.log("set linestart")
								linestart = vx[i];
								startindex = i; 
							}
							else if(linestart != null){
								// console.log("set lineend")
								lineend = vx[i]; 
								endindex = i; 

								ctx.beginPath();
								ctx.moveTo((480*linestart.x), (800*linestart.y));
								ctx.lineTo((480*lineend.x), (800*lineend.y));
								ctx.stroke();

								eg[startindex][endindex] = 1;
								eg[endindex][startindex] = 1;


								linestart = null;
								lineend = null;
							}

						}


							
					}
					if(incircle == false)
					{
						ctx.beginPath();
						ctx.arc(oldX , oldY, 10, 0, 2*Math.PI);
						ctx.stroke();

						vx.push({x:x, y:y});

						eg.push([0]);
						for(var i = 0; i < vx.length; i++){
							for(var j = eg[i].length; j < vx.length; j ++){
								eg[i].push(0);
							}
						}
					} 

					document.getElementById("out").innerHTML = JSON.stringify(obj, null, 4);
				}
				else 
				{
					x = event.clientX + document.body.scrollLeft +
							document.documentElement.scrollLeft;
					y = event.clientY + document.body.scrollTop +
							document.documentElement.scrollTop;
				}

			}
			function distance(x1, x2, y1, y2)
			{
				return Math.sqrt((Math.pow((x1-x2), 2)) + (Math.pow((y1-y2), 2))); 
			}

		</script>

	</head>

	<body>
		<canvas id="canvas" width="480" height="800"></canvas>
		<div id="out" align="right"> 
		
		</div>
	</body>
</html>